# 📊 엑셀 업로드 LLM 정제 테스트 시스템 사용법

## 🌟 개요
보험설계사 고객 엑셀 데이터의 LLM 기반 자동 정제 및 분석을 테스트할 수 있는 웹 인터페이스입니다.

## 🚀 접속 방법
**URL**: http://127.0.0.1:8000/static/excel_upload_tester.html

## 📋 사용 단계

### 1️⃣ 기본 설정
![기본 설정 섹션]

**설정 위치**: 좌측 상단 "⚙️ LLM 프롬프트 및 설정" 카드

#### 필수 설정
- **설계사 ID**: 테스트용 설계사 ID 입력 (예: 1)
  - 노란색 배경으로 표시된 필수 입력 필드
  - 시스템에 등록된 설계사 ID여야 함

#### 선택 설정  
- **테스트 모드**: 
  - `표준 처리`: 실제 데이터베이스에 저장
  - `디버그 모드`: 상세한 디버그 정보 포함
  - `미리보기 (저장 안함)`: 처리 결과만 확인, DB에 저장하지 않음

### 2️⃣ LLM 프롬프트 설정

#### 기본 프롬프트 사용
1. **"📋 기본 프롬프트 로드"** 버튼 클릭
2. 시스템 기본 컬럼 매핑 프롬프트가 자동으로 로드됨

#### 커스텀 프롬프트 작성
1. 텍스트 영역에 직접 입력
2. 표준 필드와의 매핑 규칙 정의
3. **"🔄 초기화"** 버튼으로 초기화 가능

### 3️⃣ 엑셀 파일 업로드

**위치**: 우측 "📁 엑셀 파일 업로드" 카드

#### 파일 업로드 방법
**방법 1**: 클릭하여 선택
- 파일 업로드 영역 클릭
- 파일 탐색기에서 엑셀 파일 선택

**방법 2**: 드래그 앤 드롭
- 엑셀 파일을 업로드 영역으로 드래그
- 파일을 놓으면 자동 업로드

#### 지원 파일 형식
- ✅ `.xlsx` (Excel 2007+)
- ✅ `.xls` (Excel 97-2003)
- ❌ 최대 파일 크기: 100MB
- ❌ 최대 행 수: 10,000행

#### 선택된 파일 정보
파일 선택 후 다음 정보가 표시됩니다:
- 📊 파일명
- 파일 크기
- 최종 수정일

### 4️⃣ 기능 실행

#### 🔍 컬럼 매핑 테스트
**목적**: 실제 데이터 처리 없이 컬럼 매핑만 테스트
**실행**: **"🔍 컬럼 매핑 테스트"** 버튼 클릭
**결과**: 
- 엑셀 컬럼명 → 표준 필드명 매핑 결과
- 매핑 신뢰도 점수
- 매핑되지 않은 컬럼 목록

#### 🚀 LLM 정제 실행  
**목적**: 전체 데이터 정제 및 데이터베이스 저장
**실행**: **"🚀 LLM 정제 실행"** 버튼 클릭
**과정**:
1. 파일 읽기 (20%)
2. LLM 컬럼 분석 (40%) 
3. 데이터 정제 (60%)
4. 고객 정보 저장 (80%)
5. 가입상품 처리 (90%)
6. 완료 (100%)

## 📊 결과 해석

### ✅ 성공적인 결과 예시
```
=== LLM 엑셀 데이터 정제 결과 ===

📊 처리 통계:
- 처리된 행 수: 20
- 생성된 고객 수: 18
- 수정된 고객 수: 2
- 총 상품 수: 25
- 생성된 상품 수: 23
- 실패한 상품 수: 2

🎯 매핑 성공률: 85.5%
⏱️ 처리 시간: 3.24초
```

### 📈 성능 지표 설명
- **처리된 행 수**: 엑셀에서 읽은 총 데이터 행 수
- **생성된 고객 수**: 새로 생성된 고객 수
- **수정된 고객 수**: 기존 고객 정보 업데이트 수
- **총 상품 수**: 처리 대상 가입상품 수
- **매핑 성공률**: 컬럼 매핑 정확도 (80% 이상 권장)
- **처리 시간**: 전체 처리 소요 시간

### ⚠️ 오류 발생 시
오류 정보가 상세히 표시됩니다:
- 행 번호별 오류 메시지
- 데이터 검증 실패 사유
- 해결 방법 제안

## 🔍 지원하는 데이터 필드

### 👤 고객 정보 (16개 필드)
| 표준 필드명 | 엑셀 컬럼명 예시 | 설명 |
|------------|----------------|------|
| customer_name | 고객이름, 성명, 이름 | 고객 이름 |
| customer_type | 유형, 고객유형, 가입여부 | '가입' 또는 '미가입' |
| contact_channel | 접점, 경로, 채널 | 고객 접점 경로 |
| phone | 전화, 연락처, 핸드폰 | 전화번호 (000-0000-0000 형식) |
| resident_number | 주민번호, 주민등록번호 | 주민번호 (999999-1****** 형식) |
| address | 주소, 거주지 | 거주지 주소 |
| job_title | 직업, 직장 | 직업 정보 |
| bank_name | 은행, 계좌은행 | 계좌 은행 |
| account_number | 계좌, 계좌번호 | 계좌번호 |
| referrer | 소개자, 추천인 | 소개자 정보 |

### 🏦 가입상품 정보 (6개 필드)
| 표준 필드명 | 엑셀 컬럼명 예시 | 설명 |
|------------|----------------|------|
| product_name | 상품명, 보험명, 가입상품 | 가입상품명 |
| coverage_amount | 가입금액, 보장금액 | 보장 금액 |
| subscription_date | 가입일, 계약일 | 가입 일자 |
| expiry_renewal_date | 만료일, 갱신일, 종료일 | 종료/갱신 일자 |
| auto_transfer_date | 이체일, 납입일 | 자동이체 일자 |
| policy_issued | 증권발급, 증권교부 | 증권교부 여부 (예/아니오) |

## 🛠️ 문제 해결

### ❌ 컬럼 매핑이 모두 'unmapped'로 나올 때
**원인**: 
- 프롬프트가 엑셀 컬럼명을 인식하지 못함
- LLM 응답이 예상 형식과 다름

**해결방법**:
1. **"📋 기본 프롬프트 로드"** 클릭하여 검증된 프롬프트 사용
2. 엑셀 컬럼명을 더 명확하게 수정 (예: "이름" → "고객이름")
3. 커스텀 프롬프트에서 구체적인 매핑 규칙 명시

### ❌ 파일 업로드 실패
**원인 및 해결**:
- **파일 형식**: `.xlsx` 또는 `.xls`만 지원
- **파일 크기**: 100MB 이하로 제한
- **파일 내용**: 비어있지 않은 데이터 필요

### ❌ 설계사 ID 오류
**메시지**: "설계사 ID X를 찾을 수 없습니다"
**해결**: 시스템에 등록된 유효한 설계사 ID 사용 (기본값: 1)

### ❌ 처리 시간 초과
**원인**: 대용량 파일이나 복잡한 데이터
**해결**: 
- 파일을 작은 단위로 분할
- 불필요한 컬럼 제거
- 표준 테스트 모드 사용

## 💡 효율적인 사용 팁

### 🎯 데이터 준비
1. **표준화된 컬럼명 사용**: "이름" → "고객이름"
2. **필수 필드 포함**: 최소한 고객이름과 전화번호
3. **데이터 정제**: 공백, 특수문자 제거
4. **통일된 형식**: 날짜, 전화번호 형식 통일

### 🔄 반복 테스트
1. **컬럼 매핑 테스트 먼저 실행**: 전체 처리 전 매핑 확인
2. **단계별 확인**: 작은 데이터로 먼저 테스트
3. **프롬프트 최적화**: 매핑 성공률이 낮으면 프롬프트 수정

### 📊 성능 모니터링
- **매핑 성공률**: 80% 이상 목표
- **처리 시간**: 1000행 기준 30초 이내
- **오류율**: 5% 이하 권장

## 🚨 주의사항

### 🔒 보안
- **실제 개인정보 사용 금지**: 테스트용 더미 데이터 사용
- **주민번호**: 자동으로 마스킹 처리 (999999-1******)
- **설계사별 데이터 격리**: 설계사 ID로 데이터 격리

### 💾 데이터 저장
- **표준 처리 모드**: 실제 데이터베이스에 저장됨
- **미리보기 모드**: 저장하지 않음 (테스트용)
- **중복 방지**: 동일한 고객/상품 중복 체크

### ⚡ 시스템 제한
- **동시 접속**: 다중 사용자 동시 사용 시 성능 저하 가능
- **파일 크기**: 100MB, 10,000행 제한
- **처리 시간**: 대용량 파일은 수 분 소요 가능

---

## 📞 문의 및 지원

**문제 발생 시**:
1. 브라우저 개발자 도구(F12) 확인
2. 네트워크 오류 메시지 확인
3. 서버 로그 점검

**추가 기능 요청**:
- 새로운 필드 추가
- 커스텀 데이터 검증 규칙
- 배치 처리 기능

**테스트 데이터**:
`tests/excel-upload/test_excel_files/` 폴더의 샘플 파일 활용