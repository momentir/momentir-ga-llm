<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏóëÏÖÄ ÏóÖÎ°úÎìú LLM Ï†ïÏ†ú ÌÖåÏä§Ìä∏ ÏãúÏä§ÌÖú</title>
    <!-- SheetJS ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f6fa;
            color: #2f3640;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e8ed;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background-color: #e3f2fd;
        }

        .file-input {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 16px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 14px;
            color: #adb5bd;
        }

        .selected-file {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }

        .selected-file .file-name {
            font-weight: 600;
            color: #155724;
        }

        .selected-file .file-info {
            font-size: 12px;
            color: #6c757d;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
        }

        .success {
            border-left: 4px solid #2ecc71;
            background-color: #d5f4e6;
        }

        .error {
            border-left: 4px solid #e74c3c;
            background-color: #ffeaea;
        }

        .warning {
            border-left: 4px solid #f39c12;
            background-color: #fff5e1;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-top: 10px;
        }

        .progress-fill {
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .user-id-input {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }

        .settings-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .settings-panel h3 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 1.1em;
        }

        .settings-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            align-items: start;
        }

        .form-group input, .form-group select {
            height: 48px; /* Î™®Îì† ÏûÖÎ†• ÌïÑÎìú ÎÜíÏù¥ ÌÜµÏùº */
        }

        /* ÌîÑÎ°¨ÌîÑÌä∏ Í¥ÄÎ¶¨ Ïä§ÌÉÄÏùº */
        .prompt-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f8f9fa;
            margin-bottom: 10px;
        }

        .prompt-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .prompt-item:hover {
            background-color: #e9ecef;
        }

        .prompt-item:last-child {
            border-bottom: none;
        }

        .prompt-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            font-weight: 600;
        }

        .prompt-item.selected:hover {
            background-color: #e3f2fd;
        }

        .prompt-meta {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .supported-fields {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .supported-fields h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .field-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 5px;
            font-size: 12px;
            color: #424242;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .settings-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ÏóëÏÖÄ ÏóÖÎ°úÎìú LLM Ï†ïÏ†ú ÌÖåÏä§Ìä∏ ÏãúÏä§ÌÖú</h1>
            <p>Î≥¥ÌóòÏÑ§Í≥ÑÏÇ¨ Í≥†Í∞ù ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Ïùò LLM Í∏∞Î∞ò ÏûêÎèô Ï†ïÏ†ú Î∞è Î∂ÑÏÑùÏùÑ ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî</p>
        </div>

        <div class="main-content">
            <!-- ÌîÑÎ°¨ÌîÑÌä∏ Î∞è ÏÑ§Ï†ï Í¥ÄÎ¶¨ ÏÑπÏÖò -->
            <div class="card">
                <h2>‚öôÔ∏è LLM ÌîÑÎ°¨ÌîÑÌä∏ Î∞è ÏÑ§Ï†ï</h2>
                
                <div class="settings-panel">
                    <h3>Í∏∞Î≥∏ ÏÑ§Ï†ï</h3>
                    <div class="settings-row">
                        <div class="form-group">
                            <label for="user-id">ÏÑ§Í≥ÑÏÇ¨ ID (ÌïÑÏàò)</label>
                            <input type="number" id="user-id" class="user-id-input" placeholder="Ïòà: 1" value="1">
                            <small style="color: #6c757d;">ÌÖåÏä§Ìä∏Ïö© ÏÑ§Í≥ÑÏÇ¨ IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</small>
                        </div>
                        <div class="form-group">
                            <label for="test-mode">ÌÖåÏä§Ìä∏ Î™®Îìú</label>
                            <select id="test-mode">
                                <option value="standard">ÌëúÏ§Ä Ï≤òÎ¶¨</option>
                                <option value="debug">ÎîîÎ≤ÑÍ∑∏ Î™®Îìú</option>
                                <option value="dry-run">ÎØ∏Î¶¨Î≥¥Í∏∞ (Ï†ÄÏû• ÏïàÌï®)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prompt-name">ÌîÑÎ°¨ÌîÑÌä∏ Ïù¥Î¶Ñ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                    <input type="text" id="prompt-name" placeholder="Ïòà: ÎßûÏ∂§Ìòï Ïª¨Îüº Îß§Ìïë ÌîÑÎ°¨ÌîÑÌä∏">
                </div>

                <div class="form-group">
                    <label for="custom-prompt">Ïª§Ïä§ÌÖÄ Ïª¨Îüº Îß§Ìïë ÌîÑÎ°¨ÌîÑÌä∏</label>
                    <textarea id="custom-prompt" placeholder="Í∏∞Î≥∏ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÇ¨Ïö©ÌïòÍ±∞ÎÇò Ïª§Ïä§ÌÖÄ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="savePrompt()">üíæ ÌîÑÎ°¨ÌîÑÌä∏ Ï†ÄÏû•</button>
                    <button class="btn btn-success" id="update-prompt-btn" onclick="updatePrompt()" style="display: none;">‚úèÔ∏èÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï</button>
                    <button class="btn btn-secondary" onclick="loadDefaultPrompt()">üìã Í∏∞Î≥∏ ÌîÑÎ°¨ÌîÑÌä∏ Î°úÎìú</button>
                    <button class="btn btn-secondary" onclick="clearPrompt()">üîÑ Ï¥àÍ∏∞Ìôî</button>
                </div>

                <div class="form-group">
                    <label>Ï†ÄÏû•Îêú ÌîÑÎ°¨ÌîÑÌä∏ Î™©Î°ù</label>
                    <div class="prompt-list" id="prompt-list">
                        <div class="loading" id="prompt-loading">
                            <div class="spinner"></div>
                            Î°úÎî© Ï§ë...
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="loadPrompts()">üìÇ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®</button>
                </div>

                <div class="supported-fields">
                    <h4>üîç ÏßÄÏõêÌïòÎäî Îç∞Ïù¥ÌÑ∞ ÌïÑÎìú</h4>
                    <div class="field-list">
                        <div>‚Ä¢ Í≥†Í∞ùÏù¥Î¶Ñ (name)</div>
                        <div>‚Ä¢ ÏÜåÏÜç (affiliation)</div>
                        <div>‚Ä¢ ÏÑ±Î≥Ñ (gender)</div>
                        <div>‚Ä¢ ÏÉùÎÖÑÏõîÏùº (date_of_birth)</div>
                        <div>‚Ä¢ Í¥ÄÏã¨ÏÇ¨ (interests)</div>
                        <div>‚Ä¢ Ïù∏ÏÉùÏù¥Î≤§Ìä∏ (life_events)</div>
                        <div>‚Ä¢ Î≥¥ÌóòÏÉÅÌíàÏ†ïÎ≥¥ (insurance_products)</div>
                        <div>‚Ä¢ Í≥†Í∞ùÏú†Ìòï (customer_type)</div>
                        <div>‚Ä¢ Ï†ëÏ†êÏ±ÑÎÑê (contact_channel)</div>
                        <div>‚Ä¢ Ï†ÑÌôîÎ≤àÌò∏ (phone)</div>
                        <div>‚Ä¢ Ï£ºÎØºÎ≤àÌò∏ (resident_number)</div>
                        <div>‚Ä¢ Ï£ºÏÜå (address)</div>
                        <div>‚Ä¢ ÏßÅÏóÖ (job_title)</div>
                        <div>‚Ä¢ Í≥ÑÏ¢åÏùÄÌñâ (bank_name)</div>
                        <div>‚Ä¢ Í≥ÑÏ¢åÎ≤àÌò∏ (account_number)</div>
                        <div>‚Ä¢ ÏÜåÍ∞úÏûê (referrer)</div>
                        <div>‚Ä¢ ÏÉÅÌíàÎ™Ö (product_name)</div>
                        <div>‚Ä¢ Í∞ÄÏûÖÍ∏àÏï° (coverage_amount)</div>
                        <div>‚Ä¢ Í∞ÄÏûÖÏùº (subscription_date)</div>
                        <div>‚Ä¢ Ï¢ÖÎ£åÏùº/Í∞±Ïã†Ïùº (expiry_renewal_date)</div>
                        <div>‚Ä¢ ÏûêÎèôÏù¥Ï≤¥Ïùº (auto_transfer_date)</div>
                        <div>‚Ä¢ Ï¶ùÍ∂åÍµêÎ∂Ä (policy_issued)</div>
                    </div>
                </div>
            </div>

            <!-- ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú ÏÑπÏÖò -->
            <div class="card">
                <h2>üìÅ ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú</h2>
                
                <div class="form-group">
                    <div class="file-upload-area" onclick="document.getElementById('file-input').click()">
                        <input type="file" id="file-input" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
                        <div class="upload-icon">üìä</div>
                        <div class="upload-text">ÌÅ¥Î¶≠ÌïòÏó¨ ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò</div>
                        <div class="upload-hint">ÌååÏùºÏùÑ Ïó¨Í∏∞Î°ú ÎìúÎûòÍ∑∏ & ÎìúÎ°≠ÌïòÏÑ∏Ïöî</div>
                        <div class="upload-hint">(ÏßÄÏõê ÌòïÏãù: .xlsx, .xls | ÏµúÎåÄ 100MB)</div>
                    </div>
                    <div id="selected-file" style="display: none;"></div>
                </div>

                <div class="form-group">
                    <button class="btn btn-success" id="llm-test-btn" onclick="runLLMTest()" disabled>üöÄ LLM ÌÖåÏä§Ìä∏ ÌïòÍ∏∞</button>
                    <button class="btn btn-secondary" onclick="clearFile()">üóëÔ∏è ÌååÏùº Ï¥àÍ∏∞Ìôî</button>
                </div>

                <div class="loading" id="upload-loading">
                    <div class="spinner"></div>
                    <div id="upload-status">LLMÏù¥ ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                    <div class="progress-bar" style="margin-top: 15px;">
                        <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Í≤∞Í≥º ÏÑπÏÖò -->
        <div class="results-section">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üìä LLM Ï†ïÏ†ú Í≤∞Í≥º</h2>
                    <button class="btn btn-success" id="download-excel-btn" onclick="downloadProcessedDataAsExcel()" style="display: none;">
                        üìÅ Í∏∞Ï°¥ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú
                    </button>
                </div>
                <div id="result-container">
                    <p style="color: #6c757d; text-align: center; padding: 40px;">
                        ÏóëÏÖÄ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† LLM Ï†ïÏ†úÎ•º Ïã§ÌñâÌïòÎ©¥ Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let uploadProgress = 0;
        
        // ÌîÑÎ°¨ÌîÑÌä∏ Í¥ÄÎ¶¨Ïö© Ï†ÑÏó≠ Î≥ÄÏàò
        let savedPrompts = [];
        let currentPromptId = null;
        
        // ÏóëÏÖÄ Îã§Ïö¥Î°úÎìúÏö© Ï†ÑÏó≠ Î≥ÄÏàò
        let lastProcessedData = null;

        // Í∏∞Î≥∏ Ïª¨Îüº Îß§Ìïë ÌîÑÎ°¨ÌîÑÌä∏
        const DEFAULT_MAPPING_PROMPT = `ÎãπÏã†ÏùÄ Î≥¥ÌóòÏÑ§Í≥ÑÏÇ¨Ïùò Í≥†Í∞ù ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÎäî Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§.
Ï£ºÏñ¥ÏßÑ ÏóëÏÖÄ Ïª¨ÎüºÎì§ÏùÑ ÌëúÏ§Ä ÌïÑÎìúÏôÄ Ï†ïÌôïÌûà Îß§ÌïëÌï¥Ï£ºÏÑ∏Ïöî.

Îß§Ìïë Í∑úÏπô:
- ÏÑ±Î™Ö, Í≥†Í∞ùÎ™Ö, Ïù¥Î¶Ñ, Í≥†Í∞ùÏù¥Î¶Ñ ‚Üí name
- Ï†ÑÌôî, Ïó∞ÎùΩÏ≤ò, Ìï∏ÎìúÌè∞, Ìï∏ÎìúÌè∞Î≤àÌò∏, Ï†ÑÌôîÎ≤àÌò∏ ‚Üí phone
- ÌöåÏÇ¨, ÏÜåÏÜç, ÏßÅÏû•, Í∏∞Í¥Ä ‚Üí affiliation
- ÏÑ±Î≥Ñ ‚Üí gender
- ÏÉùÎÖÑÏõîÏùº, ÏÉùÏùº, Ï∂úÏÉùÏùº ‚Üí date_of_birth
- Í¥ÄÏã¨ÏÇ¨, Ï∑®ÎØ∏, Í¥ÄÏã¨Î∂ÑÏïº ‚Üí interests
- Ïù∏ÏÉùÏù¥Î≤§Ìä∏, ÏÉùÌôúÏù¥Î≤§Ìä∏, Ïù¥Î≤§Ìä∏ ‚Üí life_events
- Î≥¥ÌóòÏÉÅÌíàÏ†ïÎ≥¥, Í∏∞Ï°¥Î≥¥Ìóò, Î≥¥Ïú†Î≥¥Ìóò ‚Üí insurance_products
- Î∂ÑÎ•ò, Ïú†Ìòï, Í≥†Í∞ùÏú†Ìòï ‚Üí customer_type
- Í≤ΩÎ°ú, Ï†ëÏ†ê, Ï±ÑÎÑê ‚Üí contact_channel
- Ìï∏ÎìúÌè∞, Ï†ÑÌôîÎ≤àÌò∏, Ìú¥ÎåÄÌè∞ ‚Üí phone (Ï†ÑÌôîÎ≤àÌò∏ Ï†ÑÏö©)
- Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏, Ï£ºÎØºÎ≤àÌò∏ ‚Üí resident_number
- Í±∞Ï£ºÏßÄ, Ï£ºÏÜå ‚Üí address
- ÏßÅÏû•, ÏßÅÏóÖ ‚Üí job_title
- Î≥¥ÌóòÏÉÅÌíà, ÏÉÅÌíàÎ™Ö, Í∞ÄÏûÖÏÉÅÌíà, Î≥¥ÌóòÎ™Ö ‚Üí product_name
- Î≥¥Ïû•Ïï°, Í∞ÄÏûÖÍ∏àÏï°, Î≥¥Ïû•Í∏àÏï° ‚Üí coverage_amount
- Í≥ÑÏïΩÏùº, Í∞ÄÏûÖÏùº ‚Üí subscription_date
- Í∞±Ïã†Ïùº, ÎßåÎ£åÏùº, Ï¢ÖÎ£åÏùº ‚Üí expiry_renewal_date
- Ïù¥Ï≤¥Ïùº, ÎÇ©ÏûÖÏùº ‚Üí auto_transfer_date
- Ï¶ùÍ∂åÎ∞úÍ∏â, Ï¶ùÍ∂åÍµêÎ∂Ä ‚Üí policy_issued
- ÏùÄÌñâ, Í≥ÑÏ¢åÏùÄÌñâ ‚Üí bank_name
- Í≥ÑÏ¢å, Í≥ÑÏ¢åÎ≤àÌò∏ ‚Üí account_number
- ÏÜåÍ∞úÏûê, Ï∂îÏ≤úÏù∏ ‚Üí referrer

Ï†ïÌôïÌûà JSON ÌòïÏãùÏúºÎ°úÎßå ÏùëÎãµÌï¥Ï£ºÏÑ∏Ïöî:
{
  "mapping": {
    "ÏóëÏÖÄÏª¨ÎüºÎ™Ö": "ÌëúÏ§ÄÌïÑÎìúÎ™Ö"
  },
  "confidence_score": 0.95
}

Ìú¥ÎåÄÌè∞ Î≤àÌò∏

ÌïúÍµ≠ Ìú¥ÎåÄÌè∞ Î≤àÌò∏Îäî Ìï≠ÏÉÅ 010ÏúºÎ°ú ÏãúÏûëÌïòÎ©∞ Ï¥ù 11ÏûêÎ¶¨ Ïà´ÏûêÎã§.
ÏóëÏÖÄ Ìè¨Îß∑ÏúºÎ°ú Ïù∏Ìï¥ Îß® Ïïû 0Ïù¥ ÏÉùÎûµÎê† Ïàò ÏûàÏúºÎãà, 10ÏúºÎ°ú ÏãúÏûëÌïòÎäî Í≤ΩÏö∞ ÏïûÏóê 0ÏùÑ Î≥¥Ï†ïÌïú Îí§ Ìï¥ÏÑùÌïúÎã§.
Ìú¥ÎåÄÌè∞/Ï†ÑÌôî Í¥ÄÎ†® Ïª¨ÎüºÏùÄ Î™®Îëê phoneÏúºÎ°ú Îß§ÌïëÌïúÎã§.

ÏÑ±Î≥Ñ

ÏÑ±Î≥ÑÏùÄ Î∞òÎìúÏãú ‚ÄòÎÇ®Ïûê‚Äô ÎòêÎäî ‚ÄòÏó¨Ïûê‚Äô Ï§ë ÌïòÎÇòÎ°úÎßå Ìï¥ÏÑù¬∑Ï†ïÍ∑úÌôîÌïúÎã§(ÎÇ®/Ïó¨, M/F Îì±ÏùÄ Í∞ÅÍ∞Å ÎÇ®Ïûê/Ïó¨ÏûêÎ°ú Î≥ÄÌôò Í∞ÄÏ†ï).

ÏÉùÎÖÑÏõîÏùº

YYYY-MM-DD ÎòêÎäî YYYYMMDD Ìè¨Îß∑ÏúºÎ°ú Ï£ºÏñ¥ÏßÄÎäî Í≤ΩÏö∞Í∞Ä ÎßéÎã§.
Ìè¨Îß∑Ïóê Íµ¨Ïï†Î∞õÏßÄ ÎßêÍ≥† ÎÇ†Ïßú ÏùòÎØ∏Î•º Ïù∏ÏãùÌï¥ date_of_birthÎ°ú Îß§ÌïëÌïúÎã§.

Ïö∞Ìé∏Î≤àÌò∏

ÎåÄÌïúÎØºÍµ≠ Ïö∞Ìé∏Î≤àÌò∏Îäî Ìï≠ÏÉÅ Ïà´Ïûê 5ÏûêÎ¶¨Îã§. Ïù¥ Ìå®ÌÑ¥ÏùÑ Í∞ÄÏßÑ Ïª¨ÎüºÏùÄ Ï£ºÏÜå Î≥¥Ï°∞ Ï†ïÎ≥¥Î°ú Ïù∏ÏãùÌïúÎã§(ÌïÑÎìúÍ∞Ä Îî∞Î°ú ÏóÜÎã§Î©¥ addressÎ°ú ÌÜµÌï© Í∞ÄÎä•).

Î∂àÌïÑÏöî/ÎØºÍ∞ê Îç∞Ïù¥ÌÑ∞

Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏Îäî resident_numberÎ°ú Îß§ÌïëÌïòÎêò, ÎßàÏä§ÌÇπ Ï†ÑÏ†ú(Ïòà: 999999-1****)**Î°ú Îã§Î§ÑÏïº ÌïúÎã§.
Í≥ÑÏ¢åÎ≤àÌò∏¬∑ÏùÄÌñâÎ™ÖÏùÄ Í∞ÅÍ∞Å account_number, bank_nameÏúºÎ°ú Îß§ÌïëÌïúÎã§(Ïà´Ïûê¬∑ÌïòÏù¥Ìîà ÌòºÏû¨ Í∞ÄÎä•).

Ï∂úÎ†• ÌòïÏãù

Ï†ïÌôïÌïú JSONÎßå ÏùëÎãµ. mapping ÌÇ§Îäî ‚ÄúÏõêÎ≥∏ Ïª¨ÎüºÎ™Ö ‚Üí ÌëúÏ§Ä ÌïÑÎìúÎ™Ö‚Äù ÎîïÏÖîÎÑàÎ¶¨Ïó¨Ïïº ÌïòÍ≥†, Îß§Ìïë Î∂àÍ∞Ä Ìï≠Î™©ÏùÄ "unmapped"Î°ú ÌëúÍ∏∞ÌïúÎã§.
confidence_score(0~1)Î•º Ìè¨Ìï®ÌïúÎã§.

name

ÌïúÍ∏Ä¬∑ÏòÅÎ¨∏ Ïù¥Î¶Ñ ÌïÑÎìú(Ïòà: ÏÑ±Î™Ö, Í≥†Í∞ùÎ™Ö, ÏòÅÎ¨∏Î™Ö Îì±)Îäî nameÏúºÎ°ú Îß§Ìïë. Ïù¥Î©îÏùº Ï£ºÏÜåÎÇò ÌöåÏÇ¨Î™ÖÏù¥ ÏÑûÏó¨ ÏûàÏúºÎ©¥ nameÏúºÎ°ú Îß§ÌïëÌïòÏßÄ Îßê Í≤É.

affiliation

ÌöåÏÇ¨/Í∏∞Í¥Ä/Î∂ÄÏÑú/ÏßÅÏû•Î™ÖÏùÄ affiliation. Í∞úÏù∏ Ï£ºÏÜåÏôÄ ÌòºÎèô Í∏àÏßÄ.

gender

ÏûÖÎ†• Î≥ÄÌòï(ÎÇ®/Ïó¨, M/F, male/female)ÏùÄ ÎÇ®Ïûê/Ïó¨ÏûêÎ°ú Ï†ïÍ∑úÌôî Í∞ÄÏ†ï.

date_of_birth

YYYY-MM-DD, YYYYMMDD, YYYY/MM/DD, YYYY.MM.DD Îì± Îã§ÏñëÌïú ÌëúÍ∏∞Î•º ÏÉùÎÖÑÏõîÏùº ÏùòÎØ∏Î©¥ date_of_birthÎ°ú Îß§Ìïë.
ÎÇòÏù¥(Îßå 35ÏÑ∏ Îì±)Îßå ÏûàÏúºÎ©¥ unmappedÎ°ú ÎëêÍ≥†, Î≥ÑÎèÑ ÌååÏÉù Î°úÏßÅ ÎåÄÏÉÅ.

interests

ÏâºÌëú¬∑Ïä¨ÎûòÏãú Íµ¨Î∂Ñ Î™©Î°ùÏù¥Î©¥ Î¶¨Ïä§Ìä∏Î°ú Í∞ÑÏ£º. Îã®Ïùº Î¨∏ÏûêÏó¥Îßå ÏûàÏúºÎ©¥ Îã®Ïùº Ìï≠Î™© Î¶¨Ïä§Ìä∏Î°ú Í∞ÄÏ†ï Í∞ÄÎä•.

life_events

Í≤∞Ìòº/Ï∂úÏÇ∞/Ïù¥ÏÇ¨/Ï∑®ÏóÖ/ÏäπÏßÑ/Ìá¥ÏßÅ/ÏûêÎÖÄÏßÑÌïô Îì± Ïù¥Î≤§Ìä∏ÏÑ± ÌÖçÏä§Ìä∏Îäî life_eventsÎ°ú. ÎÇ†Ïßú¬∑Î©îÎ™®Í∞Ä Ìï®Íªò ÏûàÏúºÎ©¥ ÌïòÎÇòÏùò Í∞ùÏ≤¥Î°ú Ìï¥ÏÑù(Í∞ÄÎä•ÌïòÎ©¥ {event, date, note} Íµ¨Ï°∞Î•º ÏÉÅÏ†ï).

insurance_products

‚ÄúÎ≥¥Ïú†/Í∏∞Ï°¥ Î≥¥Ìóò‚Äù Í∞ôÏùÄ ÏöîÏïΩÌòïÏùÄ insurance_productsÎ°ú. Íµ¨Ï≤¥ Ìï≠Î™©(ÏÉÅÌíàÎ™Ö¬∑Í∞ÄÏûÖÍ∏àÏï°¬∑ÏùºÏûê)Ïù¥ Î∂ÑÎ¶¨Îèº ÏûàÏúºÎ©¥ product ÌïÑÎìúÎì§Î°ú Í∞ÅÍ∞Å Îß§Ìïë.

customer_type

Í∞íÏùÄ **‚ÄòÍ∞ÄÏûÖ‚Äô / ‚ÄòÎØ∏Í∞ÄÏûÖ‚Äô**Îßå. Ïú†ÏÇ¨ÌëúÌòÑ(Í∞ÄÏûÖÏûê/Î¨¥Í∞ÄÏûÖ/Ïû†Ïû¨/Í¥ÄÏã¨)ÏùÄ ÏùòÎØ∏ÏÉÅ Îß§ÌïëÌïòÎêò Ïï†Îß§ÌïòÎ©¥ unmapped.

contact_channel

ÌóàÏö©Í∞í: Í∞ÄÏ°±, ÏßÄÏó≠, ÏÜåÍ∞ú, ÏßÄÏó≠ÎßàÏºÄÌåÖ, Ïù∏Î∞îÏö¥Îìú, Ï†úÌú¥db, Îã®Ï≤¥Í≥ÑÏïΩ, Î∞©Ïπ¥, Í∞úÏ≤ô, Í∏∞ÌÉÄ. ÎåÄÏÜåÎ¨∏Ïûê/Í≥µÎ∞±/ÌïòÏù¥Ìîà/ÌòºÏö©ÏùÄ ÎèôÏùòÏñ¥Î°ú Ïù∏Ïãù.

phone

**Ìú¥ÎåÄÌè∞ Î≤àÌò∏(010 + 8ÏûêÎ¶¨)**Î•º phoneÏúºÎ°ú Îß§Ìïë.
ÌïòÏù¥Ìîà Ïú†Î¨¥ÏôÄ Í≥µÎ∞±ÏùÄ Î¨¥Ïãú(Ï†ïÍ∑úÌôî Ï†ÑÏ†ú).

resident_number

13ÏûêÎ¶¨ Ïà´Ïûê(ÌïòÏù¥Ìîà Ìè¨Ìï® Í∞ÄÎä•)Îäî Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏Î°ú Í∞ÑÏ£º. LLMÏùÄ Îß§ÌïëÎßå ÌïòÍ≥†, ÎßàÏä§ÌÇπÏùÄ ÏÑúÎ≤ÑÏóêÏÑú Ï≤òÎ¶¨Îê®ÏùÑ Í∞ÄÏ†ï.

address

Ïãú/Íµ¨/Îèô/ÎèÑÎ°úÎ™Ö/Ïö∞Ìé∏Î≤àÌò∏Í∞Ä ÏÑûÏù∏ Î¨∏ÏûêÏó¥ÏùÄ address.
Ïö∞Ìé∏Î≤àÌò∏(5ÏûêÎ¶¨ Ïà´Ïûê)Îßå Îã®ÎèÖ Ïª¨ÎüºÏù¥Î©¥ address Î≥¥Ï°∞Î°ú Î≥¥Îêò, Ïª¨ÎüºÎ™Ö¬∑ÎÇ¥Ïö©Ïù¥ Î™®Ìò∏ÌïòÎ©¥ unmapped.

job_title

ÏßÅÏ±Ö/ÏßÅÎ¨¥(Í≥ºÏû•, ÎåÄÎ¶¨, ÏóîÏßÄÎãàÏñ¥ Îì±)Îäî job_title. ÌöåÏÇ¨Î™ÖÍ≥º ÌòºÎèô Í∏àÏßÄ(ÌöåÏÇ¨Î™Ö=affiliation).

bank_name / account_number

ÏùÄÌñâÎ™ÖÏùÄ bank_name(Íµ≠Î¨∏/ÏòÅÎ¨∏/ÏïΩÏπ≠ Î™®Îëê ÌóàÏö©), Ïà´Ïûê ÏúÑÏ£º Î¨∏ÏûêÏó¥ÏùÄ account_number.
Ïπ¥ÎìúÎ≤àÌò∏(16ÏûêÎ¶¨ Ìå®ÌÑ¥)Îäî account_numberÎ°ú Îß§ÌïëÌïòÏßÄ Îßê Í≤É(unmapped).

referrer

ÏÜåÍ∞úÏûê/Ï∂îÏ≤úÏù∏/ÏßÄÏù∏ Ïù¥Î¶ÑÏùÄ referrer.

notes

ÏúÑ Ïñ¥Îäê Ïä§ÌÇ§ÎßàÏóêÎèÑ ÎßûÏßÄ ÏïäÎäî ÏûêÏú† ÏÑúÏà†Ìòï Î©îÎ™®Îäî notesÎ°ú.

`;

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileUpload();
            loadPrompts();
        });

        // ÌååÏùº ÏóÖÎ°úÎìú ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî
        function initializeFileUpload() {
            const uploadArea = document.querySelector('.file-upload-area');
            
            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect({target: {files: files}});
                }
            });
        }

        // ÌååÏùº ÏÑ†ÌÉù Ï≤òÎ¶¨
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ÌååÏùº ÌÉÄÏûÖ Í≤ÄÏ¶ù
            const allowedTypes = [
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // xlsx
                'application/vnd.ms-excel' // xls
            ];

            if (!allowedTypes.includes(file.type) && !file.name.match(/\.(xlsx|xls)$/i)) {
                showResult('ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§. .xlsx ÎòêÎäî .xls ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return;
            }

            // ÌååÏùº ÌÅ¨Í∏∞ Í≤ÄÏ¶ù (100MB)
            if (file.size > 100 * 1024 * 1024) {
                showResult('ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§. ÏµúÎåÄ 100MBÍπåÏßÄ ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return;
            }

            selectedFile = file;

            // ÏÑ†ÌÉùÎêú ÌååÏùº ÌëúÏãú
            const selectedFileDiv = document.getElementById('selected-file');
            selectedFileDiv.innerHTML = `
                <div class="selected-file">
                    <div class="file-name">üìä ${file.name}</div>
                    <div class="file-info">ÌÅ¨Í∏∞: ${formatFileSize(file.size)} | ÏàòÏ†ïÏùº: ${new Date(file.lastModified).toLocaleString()}</div>
                </div>
            `;
            selectedFileDiv.style.display = 'block';

            // Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.getElementById('llm-test-btn').disabled = false;

            showResult(`ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§: ${file.name}`, 'success');
        }

        // ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑ÌåÖ
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Í∏∞Î≥∏ ÌîÑÎ°¨ÌîÑÌä∏ Î°úÎìú
        function loadDefaultPrompt() {
            document.getElementById('custom-prompt').value = DEFAULT_MAPPING_PROMPT;
            showResult('Í∏∞Î≥∏ Ïª¨Îüº Îß§Ìïë ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // ÌîÑÎ°¨ÌîÑÌä∏ Ï¥àÍ∏∞Ìôî
        function clearPrompt() {
            document.getElementById('custom-prompt').value = '';
            document.getElementById('prompt-name').value = '';
            currentPromptId = null;
            updatePromptButtonVisibility();
            
            // ÏÑ†ÌÉùÎêú Ìï≠Î™© Ìï¥Ï†ú
            const promptItems = document.querySelectorAll('.prompt-item');
            promptItems.forEach(item => {
                item.classList.remove('selected');
            });
            
            showResult('ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // ÌîÑÎ°¨ÌîÑÌä∏ Î≤ÑÌäº Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
        function updatePromptButtonVisibility() {
            const updateBtn = document.getElementById('update-prompt-btn');
            if (currentPromptId) {
                updateBtn.style.display = 'inline-block';
            } else {
                updateBtn.style.display = 'none';
            }
        }

        // ÏÉà ÌîÑÎ°¨ÌîÑÌä∏ Ï†ÄÏû•
        function savePrompt() {
            const name = document.getElementById('prompt-name').value.trim() || 'Ïù¥Î¶ÑÏóÜÎäî ÌîÑÎ°¨ÌîÑÌä∏';
            const content = document.getElementById('custom-prompt').value.trim();

            if (!content) {
                showResult('ÌîÑÎ°¨ÌîÑÌä∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            try {
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const stored = localStorage.getItem('columnMappingPrompts');
                savedPrompts = stored ? JSON.parse(stored) : [];
                
                // Ìï≠ÏÉÅ ÏÉàÎ°úÏö¥ IDÎ°ú ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
                const promptId = Date.now().toString();
                const prompt = {
                    id: promptId,
                    name: name,
                    content: content,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                savedPrompts.push(prompt);
                localStorage.setItem('columnMappingPrompts', JSON.stringify(savedPrompts));
                
                showResult(`ÌîÑÎ°¨ÌîÑÌä∏ "${name}"Ïù¥(Í∞Ä) Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.`, 'success');
                
                // Î™©Î°ù ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
                loadPrompts();
                
                // Ï†ÄÏû•Îêú ÌîÑÎ°¨ÌîÑÌä∏Î•º ÌòÑÏû¨ ÏÑ†ÌÉùÏúºÎ°ú ÏÑ§Ï†ï
                currentPromptId = promptId;
                updatePromptButtonVisibility();
                
            } catch (error) {
                console.error('ÌîÑÎ°¨ÌîÑÌä∏ Ï†ÄÏû• Ï§ë Ïò§Î•ò:', error);
                showResult('ÌîÑÎ°¨ÌîÑÌä∏ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Í∏∞Ï°¥ ÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï
        function updatePrompt() {
            const name = document.getElementById('prompt-name').value.trim() || 'Ïù¥Î¶ÑÏóÜÎäî ÌîÑÎ°¨ÌîÑÌä∏';
            const content = document.getElementById('custom-prompt').value.trim();

            if (!content) {
                showResult('ÌîÑÎ°¨ÌîÑÌä∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            if (!currentPromptId) {
                showResult('ÏàòÏ†ïÌï† ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.', 'error');
                return;
            }

            try {
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const stored = localStorage.getItem('columnMappingPrompts');
                savedPrompts = stored ? JSON.parse(stored) : [];
                
                const existingIndex = savedPrompts.findIndex(p => p.id === currentPromptId);
                
                if (existingIndex >= 0) {
                    // Í∏∞Ï°¥ ÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï - created_at Ïú†ÏßÄ
                    const prompt = {
                        ...savedPrompts[existingIndex],
                        name: name,
                        content: content,
                        updated_at: new Date().toISOString()
                    };
                    savedPrompts[existingIndex] = prompt;

                    localStorage.setItem('columnMappingPrompts', JSON.stringify(savedPrompts));
                    
                    showResult(`ÌîÑÎ°¨ÌîÑÌä∏ "${name}"Ïù¥(Í∞Ä) ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.`, 'success');
                    
                    // Î™©Î°ù ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
                    loadPrompts();
                } else {
                    showResult('ÏàòÏ†ïÌï† ÌîÑÎ°¨ÌîÑÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                }
                
            } catch (error) {
                console.error('ÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï Ï§ë Ïò§Î•ò:', error);
                showResult('ÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Ï†ÄÏû•Îêú ÌîÑÎ°¨ÌîÑÌä∏ Î™©Î°ù Î°úÎìú
        function loadPrompts() {
            const listEl = document.getElementById('prompt-list');
            const loadingEl = document.getElementById('prompt-loading');
            
            if (!listEl || !loadingEl) return;
            
            // Î°úÎî© ÌëúÏãú
            loadingEl.classList.add('show');
            
            setTimeout(() => {
                try {
                    const stored = localStorage.getItem('columnMappingPrompts');
                    savedPrompts = stored ? JSON.parse(stored) : [];
                    
                    // Í∏∞Ï°¥ ÌîÑÎ°¨ÌîÑÌä∏ ÏïÑÏù¥ÌÖúÎì§Îßå Ï†úÍ±∞
                    const promptItems = listEl.querySelectorAll('.prompt-item');
                    promptItems.forEach(item => item.remove());
                    
                    // Í∏∞Ï°¥ Î©îÏãúÏßÄÎì§ Ï†úÍ±∞
                    const messages = listEl.querySelectorAll('div:not(.loading):not(#prompt-loading)');
                    messages.forEach(msg => {
                        if (!msg.classList.contains('prompt-item') && msg.id !== 'prompt-loading') {
                            msg.remove();
                        }
                    });
                    
                    if (savedPrompts.length === 0) {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.style.cssText = 'padding: 20px; text-align: center; color: #6c757d;';
                        emptyMessage.textContent = 'Ï†ÄÏû•Îêú ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.';
                        listEl.appendChild(emptyMessage);
                    } else {
                        savedPrompts.forEach(prompt => {
                            const item = document.createElement('div');
                            item.className = 'prompt-item';
                            item.dataset.promptId = prompt.id;
                            
                            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÌîÑÎ°¨ÌîÑÌä∏Ïù∏ÏßÄ ÌôïÏù∏ÌïòÏó¨ selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                            if (currentPromptId && currentPromptId === prompt.id) {
                                item.classList.add('selected');
                            }
                            
                            item.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">${prompt.name}</div>
                                        <div class="prompt-meta">
                                            ÏÉùÏÑ±: ${new Date(prompt.created_at).toLocaleString()}
                                            ${prompt.updated_at !== prompt.created_at ? ' | ÏàòÏ†ï: ' + new Date(prompt.updated_at).toLocaleString() : ''}
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px; margin: 0;" onclick="deletePrompt('${prompt.id}')" title="ÏÇ≠Ï†ú">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `;
                            item.onclick = (e) => {
                                if (!e.target.closest('button')) {
                                    loadPromptContent(prompt);
                                }
                            };
                            listEl.appendChild(item);
                        });
                    }
                    
                } catch (error) {
                    console.error('ÌîÑÎ°¨ÌîÑÌä∏ Î°úÎìú Ï§ë Ïò§Î•ò:', error);
                    
                    const promptItems = listEl.querySelectorAll('.prompt-item');
                    promptItems.forEach(item => item.remove());
                    
                    const errorMessage = document.createElement('div');
                    errorMessage.style.cssText = 'padding: 20px; text-align: center; color: #dc3545;';
                    errorMessage.textContent = 'ÌîÑÎ°¨ÌîÑÌä∏ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                    listEl.appendChild(errorMessage);
                } finally {
                    // Î°úÎî© ÌëúÏãú Ï†úÍ±∞
                    loadingEl.classList.remove('show');
                }
            }, 300);
        }

        // ÌîÑÎ°¨ÌîÑÌä∏ ÎÇ¥Ïö© Î°úÎìú
        function loadPromptContent(prompt) {
            document.getElementById('prompt-name').value = prompt.name;
            document.getElementById('custom-prompt').value = prompt.content;
            currentPromptId = prompt.id;
            
            // Î≤ÑÌäº Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            updatePromptButtonVisibility();
            
            // Î™©Î°ùÏóêÏÑú ÏÑ†ÌÉùÎêú Ìï≠Î™© ÏãúÍ∞ÅÏ†Å ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateSelectedPrompt(prompt.id);
            
            showResult(`ÌîÑÎ°¨ÌîÑÌä∏ "${prompt.name}"ÏùÑ(Î•º) Î°úÎìúÌñàÏäµÎãàÎã§.`, 'success');
        }

        // ÏÑ†ÌÉùÎêú ÌîÑÎ°¨ÌîÑÌä∏ ÏãúÍ∞ÅÏ†Å ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectedPrompt(selectedId) {
            const promptItems = document.querySelectorAll('.prompt-item');
            promptItems.forEach(item => {
                if (item.dataset.promptId === selectedId) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // ÌîÑÎ°¨ÌîÑÌä∏ ÏÇ≠Ï†ú
        function deletePrompt(promptId) {
            if (confirm('Ï†ïÎßêÎ°ú Ïù¥ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                try {
                    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                    const stored = localStorage.getItem('columnMappingPrompts');
                    savedPrompts = stored ? JSON.parse(stored) : [];
                    
                    const beforeCount = savedPrompts.length;
                    savedPrompts = savedPrompts.filter(p => p.id !== promptId);
                    const afterCount = savedPrompts.length;
                    
                    if (beforeCount === afterCount) {
                        showResult('ÏÇ≠Ï†úÌï† ÌîÑÎ°¨ÌîÑÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                        return;
                    }
                    
                    localStorage.setItem('columnMappingPrompts', JSON.stringify(savedPrompts));
                    
                    // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏÇ≠Ï†úÎêú Í≤ΩÏö∞ Ï¥àÍ∏∞Ìôî
                    if (currentPromptId === promptId) {
                        clearPrompt();
                    }
                    
                    // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    loadPrompts();
                    
                    showResult('ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
                    
                } catch (error) {
                    console.error('ÌîÑÎ°¨ÌîÑÌä∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò:', error);
                    showResult('ÌîÑÎ°¨ÌîÑÌä∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                }
            }
        }

        // ÌååÏùº Ï¥àÍ∏∞Ìôî
        function clearFile() {
            selectedFile = null;
            document.getElementById('file-input').value = '';
            document.getElementById('selected-file').style.display = 'none';
            document.getElementById('llm-test-btn').disabled = true;
            showResult('ÏÑ†ÌÉùÎêú ÌååÏùºÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // LLM ÌÖåÏä§Ìä∏ ÌïòÍ∏∞ (Ïª¨Îüº Îß§Ìïë + LLM Ï†ïÏ†ú ÌÜµÌï©)
        async function runLLMTest() {
            if (!selectedFile) {
                showResult('Î®ºÏ†Ä ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const userId = document.getElementById('user-id').value;
            if (!userId) {
                showResult('ÏÑ§Í≥ÑÏÇ¨ IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const loadingEl = document.getElementById('upload-loading');
            const statusEl = document.getElementById('upload-status');
            const progressFill = document.getElementById('progress-fill');
            
            try {
                // 1Îã®Í≥Ñ: Ïª¨Îüº Îß§Ìïë ÌÖåÏä§Ìä∏
                statusEl.textContent = '1Îã®Í≥Ñ: LLMÏù¥ ÏóëÏÖÄ Ïª¨ÎüºÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
                loadingEl.classList.add('show');
                progressFill.style.width = '25%';
                progressFill.textContent = '25%';

                const formData1 = new FormData();
                formData1.append('file', selectedFile);
                formData1.append('user_id', userId);

                const customPrompt = document.getElementById('custom-prompt').value.trim();
                if (customPrompt) {
                    formData1.append('custom_prompt', customPrompt);
                }

                const mappingResponse = await fetch('/api/customer/column-mapping', {
                    method: 'POST',
                    body: formData1
                });

                const mappingResult = await mappingResponse.json();

                if (!mappingResponse.ok) {
                    showResult(`Ïª¨Îüº Îß§Ìïë Ïò§Î•ò: ${mappingResult.detail || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}`, 'error');
                    return;
                }

                // Ïª¨Îüº Îß§Ìïë Í≤∞Í≥º ÌëúÏãú
                const mappingMessage = `=== 1Îã®Í≥Ñ: Ïª¨Îüº Îß§Ìïë Î∂ÑÏÑù Í≤∞Í≥º ===\n${JSON.stringify(mappingResult, null, 2)}\n\n`;
                showResult(mappingMessage, 'success');

                // 2Îã®Í≥Ñ: LLM Ï†ïÏ†ú Ïã§Ìñâ
                statusEl.textContent = '2Îã®Í≥Ñ: LLMÏù¥ ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Î•º Ï†ïÏ†úÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
                progressFill.style.width = '50%';
                progressFill.textContent = '50%';

                // ÏßÑÌñâÎ•† ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë
                simulateProgress();

                const formData2 = new FormData();
                formData2.append('file', selectedFile);
                formData2.append('user_id', userId);

                const testMode = document.getElementById('test-mode').value;
                if (testMode !== 'standard') {
                    formData2.append('test_mode', testMode);
                }

                // 1Îã®Í≥ÑÏóêÏÑú ÏñªÏùÄ Ïª¨Îüº Îß§Ìïë Í≤∞Í≥ºÎ•º 2Îã®Í≥ÑÎ°ú Ï†ÑÎã¨
                if (mappingResult && mappingResult.mapping) {
                    formData2.append('column_mapping_json', JSON.stringify(mappingResult.mapping));
                }

                const uploadResponse = await fetch('/api/customer/excel-upload?auto_map=false', {
                    method: 'POST',
                    body: formData2
                });

                const uploadResult = await uploadResponse.json();

                // ÏßÑÌñâÎ•† 100% ÏôÑÎ£å
                progressFill.style.width = '100%';
                progressFill.textContent = 'ÏôÑÎ£å!';

                if (uploadResponse.ok) {
                    // ÏΩòÏÜîÏóê ÏõêÎ≥∏ ÏùëÎãµ Ï∂úÎ†• (ÎîîÎ≤ÑÍπÖÏö©)
                    console.log('üîç Excel upload API ÏùëÎãµ:', uploadResult);
                    console.log('üîç ÎØ∏Î¶¨Î≥¥Í∏∞ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏:', {
                        original_data_preview: uploadResult.original_data_preview,
                        processed_data_preview: uploadResult.processed_data_preview
                    });

                    // Îã§Ïö¥Î°úÎìúÏö© Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    lastProcessedData = uploadResult.processed_data_preview;
                    
                    // Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌëúÏãú
                    const downloadBtn = document.getElementById('download-excel-btn');
                    if (downloadBtn && uploadResult.processed_data_preview) {
                        downloadBtn.style.display = 'inline-block';
                    }

                    const uploadMessage = formatUploadResult(uploadResult);
                    const finalMessage = mappingMessage + '=== 2Îã®Í≥Ñ: LLM ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ Ï†ïÏ†ú Í≤∞Í≥º ===\n\n' + uploadMessage;
                    showResult(finalMessage, 'success');
                        const resultEl = document.getElementById('result-container');
                        if (resultEl) {
                          resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          resultEl.setAttribute('tabindex', '-1');
                          resultEl.focus({ preventScroll: true });
                        }
                } else {
                    const errorMessage = mappingMessage + `\n=== 2Îã®Í≥Ñ Ïò§Î•ò ===\nÏò§Î•ò: ${uploadResult.detail || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}`;
                    showResult(errorMessage, 'error');
                }

            } catch (error) {
                showResult(`ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}`, 'error');
            } finally {
                setTimeout(() => {
                    loadingEl.classList.remove('show');
                    progressFill.style.width = '0%';
                    progressFill.textContent = '0%';
                    uploadProgress = 0;
                }, 1000);
            }
        }

        // Ïª¨Îüº Îß§Ìïë ÌÖåÏä§Ìä∏
        async function testColumnMapping() {
            if (!selectedFile) {
                showResult('Î®ºÏ†Ä ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const userId = document.getElementById('user-id').value;
            if (!userId) {
                showResult('ÏÑ§Í≥ÑÏÇ¨ IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const loadingEl = document.getElementById('upload-loading');
            const statusEl = document.getElementById('upload-status');
            
            statusEl.textContent = 'LLMÏù¥ ÏóëÏÖÄ Ïª¨ÎüºÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            loadingEl.classList.add('show');

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('user_id', userId);

                const customPrompt = document.getElementById('custom-prompt').value.trim();
                if (customPrompt) {
                    formData.append('custom_prompt', customPrompt);
                }

                const response = await fetch('/api/customer/column-mapping', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    const displayMessage = `=== Ïª¨Îüº Îß§Ìïë Î∂ÑÏÑù Í≤∞Í≥º ===\n${JSON.stringify(result, null, 2)}`;
                    showResult(displayMessage, 'success');
                } else {
                    showResult(`Ïò§Î•ò: ${result.detail || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}`, 'error');
                }

            } catch (error) {
                showResult(`ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}`, 'error');
            } finally {
                loadingEl.classList.remove('show');
            }
        }

        // ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú Î∞è LLM Ï†ïÏ†ú
        async function uploadExcelFile() {
            if (!selectedFile) {
                showResult('Î®ºÏ†Ä ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const userId = document.getElementById('user-id').value;
            if (!userId) {
                showResult('ÏÑ§Í≥ÑÏÇ¨ IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            const loadingEl = document.getElementById('upload-loading');
            const statusEl = document.getElementById('upload-status');
            const progressFill = document.getElementById('progress-fill');
            
            statusEl.textContent = 'LLMÏù¥ ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÍ≥† Ï†ïÏ†úÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            loadingEl.classList.add('show');

            // ÏßÑÌñâÎ•† ÏãúÎÆ¨Î†àÏù¥ÏÖò
            simulateProgress();

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('user_id', userId);

                const testMode = document.getElementById('test-mode').value;
                if (testMode !== 'standard') {
                    formData.append('test_mode', testMode);
                }

                const customPrompt = document.getElementById('custom-prompt').value.trim();
                if (customPrompt) {
                    formData.append('custom_prompt', customPrompt);
                }

                const response = await fetch('/api/customer/excel-upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // ÏßÑÌñâÎ•† 100% ÏôÑÎ£å
                progressFill.style.width = '100%';
                progressFill.textContent = 'ÏôÑÎ£å!';

                if (response.ok) {
                    const displayMessage = formatUploadResult(result);
                    showResult(displayMessage, 'success');
                } else {
                    showResult(`Ïò§Î•ò: ${result.detail || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}`, 'error');
                }

            } catch (error) {
                showResult(`ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}`, 'error');
            } finally {
                setTimeout(() => {
                    loadingEl.classList.remove('show');
                    progressFill.style.width = '0%';
                    progressFill.textContent = '0%';
                    uploadProgress = 0;
                }, 1000);
            }
        }

        // ÏóÖÎ°úÎìú Í≤∞Í≥º Ìè¨Îß∑ÌåÖ
        function formatUploadResult(result) {
            // ÎØ∏Î¶¨Î≥¥Í∏∞ Îç∞Ïù¥ÌÑ∞ ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏
            console.log('üîç formatUploadResult - ÎØ∏Î¶¨Î≥¥Í∏∞ Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú:', {
                original_exists: !!result.original_data_preview,
                processed_exists: !!result.processed_data_preview,
                original_content: result.original_data_preview,
                processed_content: result.processed_data_preview
            });

            let message = '=== LLM ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ Ï†ïÏ†ú Í≤∞Í≥º ===\n\n';
            
            // Í∏∞Î≥∏ ÌÜµÍ≥Ñ
            message += `üìä Ï≤òÎ¶¨ ÌÜµÍ≥Ñ:\n`;
            message += `- Ï≤òÎ¶¨Îêú Ìñâ Ïàò: ${result.processed_rows || 0}\n`;
            message += `- ÏÉùÏÑ±Îêú Í≥†Í∞ù Ïàò: ${result.created_customers || 0}\n`;
            message += `- ÏàòÏ†ïÎêú Í≥†Í∞ù Ïàò: ${result.updated_customers || 0}\n`;
            message += `- Ï¥ù ÏÉÅÌíà Ïàò: ${result.total_products || 0}\n`;
            message += `- ÏÉùÏÑ±Îêú ÏÉÅÌíà Ïàò: ${result.created_products || 0}\n`;
            message += `- Ïã§Ìå®Ìïú ÏÉÅÌíà Ïàò: ${result.failed_products || 0}\n\n`;

            // ÏÑ±Îä• ÏßÄÌëú
            if (result.mapping_success_rate !== undefined) {
                message += `üéØ Îß§Ìïë ÏÑ±Í≥µÎ•†: ${(result.mapping_success_rate * 100).toFixed(1)}%\n`;
            }
            
            if (result.processing_time_seconds) {
                message += `‚è±Ô∏è  Ï≤òÎ¶¨ ÏãúÍ∞Ñ: ${result.processing_time_seconds.toFixed(2)}Ï¥à\n\n`;
            }

            // ÏõêÎ≥∏ ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞
            if (result.original_data_preview && result.original_data_preview.columns) {
                message += `=== üìã ÏõêÎ≥∏ ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞ ===\n`;
                const originalData = result.original_data_preview;
                message += `Ï¥ù Ìñâ Ïàò: ${originalData.total_rows || 0}Ìñâ\n`;
                message += `Ï¥ù Ïª¨Îüº Ïàò: ${(originalData.columns || []).length}Í∞ú\n\n`;
                
                if (originalData.columns && originalData.preview_rows) {
                    message += `Ïª¨Îüº: ${originalData.columns.join(' | ')}\n`;
                    message += `${'='.repeat(Math.min(originalData.columns.join(' | ').length, 80))}\n`;
                    
                    originalData.preview_rows.slice(0, 3).forEach((row, index) => {
                        message += `${index + 1}: ${row.join(' | ')}\n`;
                    });
                    
                    if (originalData.preview_rows.length > 3) {
                        message += `... (${originalData.preview_rows.length - 3}Í∞ú Ìñâ Îçî)\n`;
                    }
                }
                message += '\n';
            } else {
                console.log('‚ö†Ô∏è ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§:', result.original_data_preview);
            }

            // Ï≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞
            if (result.processed_data_preview && (result.processed_data_preview.customers || result.processed_data_preview.products)) {
                message += `=== üéØ Ï≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞ ===\n`;
                const processedData = result.processed_data_preview;
                
                // Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ (ÌñâÎ†¨ ÌòïÌÉú)
                if (processedData.customers && processedData.customers.count > 0) {
                    message += `üë§ ÏµúÍ∑º ÏÉùÏÑ±Îêú Í≥†Í∞ù (${processedData.customers.count}Î™Ö):\n`;
                    message += `Ï¥ù Ïª¨Îüº Ïàò: ${(processedData.customers.columns || []).length}Í∞ú\n\n`;
                    
                    if (processedData.customers.columns && processedData.customers.rows) {
                        message += `Ïª¨Îüº: ${processedData.customers.columns.join(' | ')}\n`;
                        message += `${'='.repeat(Math.min(processedData.customers.columns.join(' | ').length, 80))}\n`;
                        
                        processedData.customers.rows.slice(0, 5).forEach((row, index) => {
                            message += `${index + 1}: ${row.join(' | ')}\n`;
                        });
                        
                        if (processedData.customers.rows.length > 5) {
                            message += `... (${processedData.customers.rows.length - 5}Í∞ú Ìñâ Îçî)\n`;
                        }
                    }
                    message += '\n';
                }
                
                // ÏÉÅÌíà Îç∞Ïù¥ÌÑ∞ (ÌñâÎ†¨ ÌòïÌÉú)
                if (processedData.products && processedData.products.count > 0) {
                    message += `üè¶ ÏµúÍ∑º ÏÉùÏÑ±Îêú ÏÉÅÌíà (${processedData.products.count}Í∞ú):\n`;
                    message += `Ï¥ù Ïª¨Îüº Ïàò: ${(processedData.products.columns || []).length}Í∞ú\n\n`;
                    
                    if (processedData.products.columns && processedData.products.rows) {
                        message += `Ïª¨Îüº: ${processedData.products.columns.join(' | ')}\n`;
                        message += `${'='.repeat(Math.min(processedData.products.columns.join(' | ').length, 80))}\n`;
                        
                        processedData.products.rows.slice(0, 5).forEach((row, index) => {
                            message += `${index + 1}: ${row.join(' | ')}\n`;
                        });
                        
                        if (processedData.products.rows.length > 5) {
                            message += `... (${processedData.products.rows.length - 5}Í∞ú Ìñâ Îçî)\n`;
                        }
                    }
                    message += '\n';
                }
            } else {
                console.log('‚ö†Ô∏è Ï≤òÎ¶¨Îêú Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§:', result.processed_data_preview);
            }

            // Ïò§Î•ò Ï†ïÎ≥¥
            if (result.errors && result.errors.length > 0) {
                message += `‚ö†Ô∏è  Ïò§Î•ò Î™©Î°ù (${result.errors.length}Í±¥):\n`;
                result.errors.slice(0, 10).forEach((error, index) => {
                    message += `${index + 1}. ${error}\n`;
                });
                if (result.errors.length > 10) {
                    message += `... Í∑∏ Ïô∏ ${result.errors.length - 10}Í∞ú Ïò§Î•ò\n`;
                }
                message += '\n';
            }

            // Ï†ÑÏ≤¥ ÏùëÎãµ
            message += `=== Ï†ÑÏ≤¥ API ÏùëÎãµ ===\n${JSON.stringify(result, null, 2)}`;
            
            return message;
        }

        // ÏßÑÌñâÎ•† ÏãúÎÆ¨Î†àÏù¥ÏÖò
        function simulateProgress() {
            const progressFill = document.getElementById('progress-fill');
            const statusEl = document.getElementById('upload-status');
            
            const steps = [
                { progress: 20, message: 'ÌååÏùºÏùÑ ÏùΩÍ≥† ÏûàÏäµÎãàÎã§...' },
                { progress: 40, message: 'LLMÏù¥ Ïª¨ÎüºÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { progress: 60, message: 'Îç∞Ïù¥ÌÑ∞Î•º Ï†ïÏ†úÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { progress: 80, message: 'Í≥†Í∞ù Ï†ïÎ≥¥Î•º Ï†ÄÏû•ÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { progress: 90, message: 'Í∞ÄÏûÖÏÉÅÌíà Ï†ïÎ≥¥Î•º Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§...' }
            ];

            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    progressFill.style.width = step.progress + '%';
                    progressFill.textContent = step.progress + '%';
                    statusEl.textContent = step.message;
                    uploadProgress = step.progress;
                    currentStep++;
                } else {
                    clearInterval(interval);
                }
            }, 1500);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function showResult(message, type = 'success') {
            const container = document.getElementById('result-container');
            const resultBox = document.createElement('div');
            resultBox.className = `result-box ${type}`;
            resultBox.textContent = message;

            container.innerHTML = '';
            container.appendChild(resultBox);
        }
        
        // LLM Ï†ïÏ†úÎêú Îç∞Ïù¥ÌÑ∞Î•º ÏóëÏÖÄ ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìú
        function downloadProcessedDataAsExcel() {
            if (!lastProcessedData) {
                alert('Îã§Ïö¥Î°úÎìúÌï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä ÏóëÏÖÄ ÏóÖÎ°úÎìúÎ•º Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÎØ∏Î¶¨Î≥¥Í∏∞ Îç∞Ïù¥ÌÑ∞(LLM Ï†ïÏ†ú Í≤∞Í≥º) ÌôïÏù∏ - Ïã§Ï†ú Í≥†Í∞ù ÏÉùÏÑ± Ïó¨Î∂ÄÏôÄ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï≤òÎ¶¨
            const hasCustomerData = lastProcessedData.customers && lastProcessedData.customers.rows && lastProcessedData.customers.rows.length > 0;
            const hasProductData = lastProcessedData.products && lastProcessedData.products.rows && lastProcessedData.products.rows.length > 0;
            
            if (!hasCustomerData && !hasProductData) {
                alert('Îã§Ïö¥Î°úÎìú Í∞ÄÎä•Ìïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎØ∏Î¶¨Î≥¥Í∏∞ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.\nÌï¥Îãπ ÏÑ§Í≥ÑÏÇ¨Ïùò Í∏∞Ï°¥ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ÎÇò ÏÉÅÌíà Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤É Í∞ôÏäµÎãàÎã§.');
                return;
            }
            
            try {
                // ÏÉàÎ°úÏö¥ ÏõåÌÅ¨Î∂Å ÏÉùÏÑ±
                const wb = XLSX.utils.book_new();
                let sheetsCreated = 0;
                
                // Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ ÏãúÌä∏ ÏÉùÏÑ± (ÏÑ§Í≥ÑÏÇ¨Ïùò Í∏∞Ï°¥ ÏµúÏã† Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞)
                if (hasCustomerData) {
                    const customerData = [
                        lastProcessedData.customers.columns, // Ìó§Îçî
                        ...lastProcessedData.customers.rows   // Îç∞Ïù¥ÌÑ∞ ÌñâÎì§
                    ];
                    const customerSheet = XLSX.utils.aoa_to_sheet(customerData);
                    
                    // Ïª¨Îüº ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
                    const customerCols = lastProcessedData.customers.columns.map(() => ({ wch: 15 }));
                    customerSheet['!cols'] = customerCols;
                    
                    XLSX.utils.book_append_sheet(wb, customerSheet, 'Í∏∞Ï°¥ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ (ÏµúÏã†10Î™Ö)');
                    sheetsCreated++;
                }
                
                // ÏÉÅÌíà Îç∞Ïù¥ÌÑ∞ ÏãúÌä∏ ÏÉùÏÑ± (ÏÑ§Í≥ÑÏÇ¨Ïùò Í∏∞Ï°¥ ÏµúÏã† ÏÉÅÌíà Îç∞Ïù¥ÌÑ∞)
                if (hasProductData) {
                    const productData = [
                        lastProcessedData.products.columns, // Ìó§Îçî
                        ...lastProcessedData.products.rows   // Îç∞Ïù¥ÌÑ∞ ÌñâÎì§
                    ];
                    const productSheet = XLSX.utils.aoa_to_sheet(productData);
                    
                    // Ïª¨Îüº ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
                    const productCols = lastProcessedData.products.columns.map(() => ({ wch: 15 }));
                    productSheet['!cols'] = productCols;
                    
                    XLSX.utils.book_append_sheet(wb, productSheet, 'Í∏∞Ï°¥ ÏÉÅÌíà Îç∞Ïù¥ÌÑ∞ (ÏµúÏã†10Í∞ú)');
                    sheetsCreated++;
                }
                
                // Îπà ÏõåÌÅ¨Î∂Å Î∞©ÏßÄ - ÏµúÏÜå ÌïòÎÇòÏùò ÏãúÌä∏Îäî ÏÉùÏÑ±
                if (sheetsCreated === 0) {
                    // Îπà ÏãúÌä∏ÎùºÎèÑ ÏÉùÏÑ±
                    const emptySheet = XLSX.utils.aoa_to_sheet([['Ìï¥Îãπ ÏÑ§Í≥ÑÏÇ¨Ïùò Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§']]);
                    XLSX.utils.book_append_sheet(wb, emptySheet, 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                }
                
                // ÌååÏùº Ïù¥Î¶Ñ ÏÉùÏÑ± (ÌòÑÏû¨ ÎÇ†ÏßúÏãúÍ∞Ñ Ìè¨Ìï®)
                const now = new Date();
                const timestamp = now.getFullYear() + 
                    String(now.getMonth() + 1).padStart(2, '0') + 
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') + 
                    String(now.getMinutes()).padStart(2, '0') + 
                    String(now.getSeconds()).padStart(2, '0');
                    
                const filename = `Í∏∞Ï°¥Í≥†Í∞ùÎç∞Ïù¥ÌÑ∞_${timestamp}.xlsx`;
                
                // ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú
                XLSX.writeFile(wb, filename);
                
                console.log(`‚úÖ ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú ÏôÑÎ£å: ${filename}`);
                
            } catch (error) {
                console.error('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•ò:', error);
                alert('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
    </script>
</body>
</html>