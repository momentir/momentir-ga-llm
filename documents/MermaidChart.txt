graph TD
      %% ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Í≥ÑÏ∏µ
      subgraph UI ["üñ•Ô∏è User Interface Layer"]
          PM["`üìù **prompt_manager.html**
          Î©îÎ™® Ï†ïÏ†ú ÌîÑÎ°¨ÌîÑÌä∏ Í¥ÄÎ¶¨`"]
          EU["`üìä **excel_upload_tester.html**
          ÏóëÏÖÄ ÏóÖÎ°úÎìú LLM Ï†ïÏ†ú`"]
          NS["`üîç **nl_search_tester.html**
          ÏûêÏó∞Ïñ¥ Í≤ÄÏÉâ ÌÖåÏä§ÌÑ∞`"]
      end

      %% LocalStorage RAG ÏãúÏä§ÌÖú
      subgraph LocalRAG ["üíæ LocalStorage RAG Systems"]
          PMRAG["`**Prompt Manager RAG**
          Key: 'savedPrompts'
          ‚Ä¢ ÌîÑÎ°¨ÌîÑÌä∏ ÌÖúÌîåÎ¶ø Î≤ÑÏ†Ñ Í¥ÄÎ¶¨
          ‚Ä¢ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ†Å
          ‚Ä¢ CRUD Ïù∏ÌÑ∞ÌéòÏù¥Ïä§`"]

          EURAG["`**Excel Upload RAG**
          Key: 'columnMappingPrompts'
          ‚Ä¢ 672Ï§Ñ Î≥¥ÌóòÏóÖÍ≥Ñ ÎèÑÎ©îÏù∏ ÏßÄÏãù
          ‚Ä¢ Ïª¨Îüº Îß§Ìïë Í∑úÏπô Î≤†Ïù¥Ïä§
          ‚Ä¢ ÌïÑÎìú Ï†ïÍ∑úÌôî ÌÖúÌîåÎ¶ø`"]
      end

      %% ÎèÑÎ©îÏù∏ ÏßÄÏãù Î≤†Ïù¥Ïä§
      subgraph DomainKB ["üß† Domain Knowledge Base"]
          InsuranceKB["`**Î≥¥ÌóòÏóÖÍ≥Ñ ÌäπÌôî ÏßÄÏãù**
          ‚Ä¢ Í≥†Í∞ù ÌïÑÎìú Îß§Ìïë Í∑úÏπô
          ‚Ä¢ Ìú¥ÎåÄÌè∞ Î≤àÌò∏ Ï†ïÍ∑úÌôî
          ‚Ä¢ ÏÑ±Î≥Ñ/ÏÉùÎÖÑÏõîÏùº ÌëúÏ§ÄÌôî
          ‚Ä¢ Ï£ºÎØºÎ≤àÌò∏ ÎßàÏä§ÌÇπ Í∑úÏπô
          ‚Ä¢ Î≥¥ÌóòÏÉÅÌíà Î∂ÑÎ•ò Ï≤¥Í≥Ñ`"]

          SQLKb["`**SQL/DB Ïä§ÌÇ§Îßà ÏßÄÏãù**
          ‚Ä¢ Few-shot ÏòàÏ†ú (5Îã®Í≥Ñ Î≥µÏû°ÎèÑ)
          ‚Ä¢ PostgreSQL Î¨∏Î≤ï Í∞ÄÏù¥Îìú
          ‚Ä¢ ÌÖåÏù¥Î∏î Í¥ÄÍ≥Ñ Ï†ïÏùò
          ‚Ä¢ Î≥¥Ïïà ÏøºÎ¶¨ Ìå®ÌÑ¥`"]
      end

      %% API/LangChain Í≥ÑÏ∏µ
      subgraph APIs ["üîó API & LangChain Pipelines"]
          MemoAPI["`**/api/memo/refine**
          Î©îÎ™® Ï†ïÏ†ú LLM Ï≤òÎ¶¨`"]

          ColMapAPI["`**/api/customer/column-mapping**
          Excel Ïª¨Îüº Î∂ÑÏÑù LLM`"]

          ExcelAPI["`**/api/customer/excel-upload**
          Îç∞Ïù¥ÌÑ∞ Ï†ïÏ†ú Î∞è Ï†ÄÏû•`"]

          NLSearchAPI["`**/api/search/natural-language**
          ÏûêÏó∞Ïñ¥‚ÜíSQL Î≥ÄÌôò`"]
      end

      %% LLM Ï≤òÎ¶¨ ÏóîÏßÑ
      subgraph LLMCore ["ü§ñ LLM Processing Core"]
          IntentLLM["`**Intent Classification**
          ÏûêÏó∞Ïñ¥ ÏùòÎèÑ Î∂ÑÏÑù
          Chain-of-Thought Ï∂îÎ°†`"]

          SQLLLM["`**SQL Generation LLM**
          6Îã®Í≥Ñ Ï≤¥Í≥ÑÏ†Å SQL ÏÉùÏÑ±
          ‚Ä¢ ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂ÑÏÑù
          ‚Ä¢ ÌÖåÏù¥Î∏î Í¥ÄÍ≥Ñ Î∂ÑÏÑù
          ‚Ä¢ Ï°∞Í±¥ ÏÑ§Í≥Ñ
          ‚Ä¢ ÏßëÍ≥Ñ ÏÑ§Í≥Ñ
          ‚Ä¢ Ï†ïÎ†¨ ÏÑ§Í≥Ñ
          ‚Ä¢ Í≤ÄÏ¶ù`"]

          MemoLLM["`**Memo Refinement LLM**
          Î≥¥ÌóòÏóÖÍ≥Ñ Î©îÎ™® Íµ¨Ï°∞Ìôî
          JSON ÌòïÏãù Ï∂úÎ†•`"]

          ExcelLLM["`**Excel Processing LLM**
          Two-Stage Pipeline:
          1. Column Mapping
          2. Data Refinement`"]
      end

      %% LangSmith Ï∂îÏ†Å ÏãúÏä§ÌÖú
      subgraph LangSmith ["üìä LangSmith Monitoring"]
          LSProj1["`**momentir-cx-llm**
          Î©îÎ™® Ï†ïÏ†ú ÌîÑÎ°úÏ†ùÌä∏`"]

          LSProj2["`**momentir-cx-llm-nl-search**
          ÏûêÏó∞Ïñ¥ Í≤ÄÏÉâ ÌîÑÎ°úÏ†ùÌä∏`"]

          LSProj3["`**momentir-cx-llm-excel**
          ÏóëÏÖÄ Ï≤òÎ¶¨ ÌîÑÎ°úÏ†ùÌä∏`"]

          LSConfig["`**Environment Detection**
          Production vs Local
          Project Name Mapping`"]
      end

      %% Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§
      subgraph Database ["üóÑÔ∏è Database Layer"]
          PostgresDB["`**PostgreSQL + pgvector**
          ‚Ä¢ customers (UUID PK)
          ‚Ä¢ memos
          ‚Ä¢ events
          ‚Ä¢ insurance_products
          ‚Ä¢ Vector Search Ready`"]

          SchemaCache["`**Schema Caching**
          1ÏãúÍ∞Ñ TTL
          Ïã§ÏãúÍ∞Ñ Ïä§ÌÇ§Îßà Î∞òÏòÅ`"]
      end

      %% Ïó∞Í≤∞ Í¥ÄÍ≥Ñ
      PM --> PMRAG
      EU --> EURAG

      PMRAG --> MemoAPI
      EURAG --> ColMapAPI
      EURAG --> ExcelAPI

      PM --> MemoAPI
      EU --> ColMapAPI
      EU --> ExcelAPI
      NS --> NLSearchAPI

      InsuranceKB --> ExcelLLM
      SQLKb --> SQLLLM

      MemoAPI --> MemoLLM
      ColMapAPI --> ExcelLLM
      ExcelAPI --> ExcelLLM
      NLSearchAPI --> IntentLLM
      NLSearchAPI --> SQLLLM

      IntentLLM --> LSProj2
      SQLLLM --> LSProj2
      MemoLLM --> LSProj1
      ExcelLLM --> LSProj3

      LSConfig --> LSProj1
      LSConfig --> LSProj2
      LSConfig --> LSProj3

      SQLLLM --> SchemaCache
      SchemaCache --> PostgresDB
      ExcelLLM --> PostgresDB
      MemoLLM --> PostgresDB

      %% Ïä§ÌÉÄÏùºÎßÅ
      classDef uiClass fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef ragClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      classDef apiClass fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef llmClass fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
      classDef lsClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
      classDef dbClass fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
      classDef kbClass fill:#e0f2f1,stroke:#00695c,stroke-width:2px

      class PM,EU,NS uiClass
      class PMRAG,EURAG ragClass
      class MemoAPI,ColMapAPI,ExcelAPI,NLSearchAPI apiClass
      class IntentLLM,SQLLLM,MemoLLM,ExcelLLM llmClass
      class LSProj1,LSProj2,LSProj3,LSConfig lsClass
      class PostgresDB,SchemaCache dbClass
      class InsuranceKB,SQLKb kbClass
