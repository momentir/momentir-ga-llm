<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f6fa;
            color: #2f3640;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e8ed;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        #memo-input {
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }

        .success {
            border-left: 4px solid #2ecc71;
            background-color: #d5f4e6;
        }

        .error {
            border-left: 4px solid #e74c3c;
            background-color: #ffeaea;
        }

        .prompt-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .prompt-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .prompt-item:hover {
            background-color: #e9ecef;
        }

        .prompt-item:last-child {
            border-bottom: none;
        }

        .prompt-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            font-weight: 600;
        }

        .prompt-item.selected:hover {
            background-color: #e3f2fd;
        }

        .prompt-meta {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #2ecc71;
        }

        .status-inactive {
            background: #95a5a6;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>ë©”ëª¨ ì •ì œ APIë¥¼ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
        </div>

        <div class="main-content">
            <!-- í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="card">
                <h2>ğŸ“ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬</h2>
                
                <div class="form-group">
                    <label for="prompt-name">í”„ë¡¬í”„íŠ¸ ì´ë¦„</label>
                    <input type="text" id="prompt-name" placeholder="ì˜ˆ: ê¸°ë³¸ ë©”ëª¨ ë¶„ì„ í”„ë¡¬í”„íŠ¸">
                </div>

                <div class="form-group">
                    <label for="prompt-content">í”„ë¡¬í”„íŠ¸ ë‚´ìš©</label>
                    <textarea id="prompt-content" placeholder="í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="saveNewPrompt()">ğŸ’¾ ìƒˆ í”„ë¡¬í”„íŠ¸ ì €ì¥</button>
                    <button class="btn btn-success" id="update-btn" onclick="updatePrompt()" style="display: none;">âœï¸ í”„ë¡¬í”„íŠ¸ ìˆ˜ì •</button>
                    <button class="btn btn-secondary" onclick="clearPrompt()">ğŸ”„ ì´ˆê¸°í™”</button>
                    <button class="btn btn-secondary" onclick="loadDefaultPrompt()">ğŸ“‹ ê¸°ë³¸ í…œí”Œë¦¿</button>
                </div>

                <div class="form-group">
                    <h3>ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ëª©ë¡</h3>
                    <div class="prompt-list" id="prompt-list">
                        <div class="loading" id="prompt-loading">
                            <div class="spinner"></div>
                            ë¡œë”© ì¤‘...
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="loadPrompts()" style="margin-top: 10px;">ğŸ“‚ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-secondary" onclick="debugStorage()" style="margin-top: 10px;">ğŸ” ì €ì¥ì†Œ ìƒíƒœ í™•ì¸</button>
                </div>
            </div>

            <!-- í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div class="card">
                <h2>ğŸ§ª í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸</h2>
                
                <div class="form-group">
                    <label for="memo-input">í…ŒìŠ¤íŠ¸ìš© ë©”ëª¨ ë‚´ìš©</label>
                    <textarea id="memo-input" placeholder="í…ŒìŠ¤íŠ¸í•  ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...
ì˜ˆ: ê³ ê°ì´ ì „í™”ë¡œ ë³´í—˜ë£Œ ì¸ìƒì— ëŒ€í•´ ë¬¸ì˜í•¨. 2ì£¼ í›„ ë‹¤ì‹œ ì—°ë½í•˜ê¸°ë¡œ í•¨. í˜„ì¬ ìë™ì°¨ë³´í—˜ì— ê°€ì…ë˜ì–´ ìˆê³  í™”ì¬ë³´í—˜ë„ ê´€ì‹¬ìˆì–´í•¨."></textarea>
                </div>

                <div class="form-group">
                    <button class="btn btn-success" onclick="testPrompt()">ğŸš€ ì‹¤í–‰</button>
                    <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”</button>
                </div>

                <div class="loading" id="test-loading">
                    <div class="spinner"></div>
                    AIê°€ ë©”ëª¨ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...
                </div>
            </div>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div class="results-section">
            <div class="card">
                <h2>ğŸ“Š ì‹¤í–‰ ê²°ê³¼</h2>
                <div id="result-container">
                    <p style="color: #6c757d; text-align: center; padding: 40px;">
                        í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let savedPrompts = [];
        let currentPromptId = null;

        // ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
        const DEFAULT_PROMPT = `ë‹¹ì‹ ì€ ë³´í—˜íšŒì‚¬ì˜ ê³ ê° ë©”ëª¨ë¥¼ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ê³ ê° ë©”ëª¨ì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ì¶”ì¶œí•´ì£¼ì„¸ìš”:

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "summary": "ë©”ëª¨ ìš”ì•½",
  "status": "ê³ ê° ìƒíƒœ/ê°ì •",
  "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"],
  "time_expressions": [
    {"expression": "2ì£¼ í›„", "parsed_date": "2024-01-15"}
  ],
  "required_actions": ["í•„ìš”í•œ í›„ì† ì¡°ì¹˜"],
  "insurance_info": {
    "products": ["í˜„ì¬ ê°€ì… ìƒí’ˆ"],
    "premium_amount": "ë³´í—˜ë£Œ ì •ë³´",
    "interest_products": ["ê´€ì‹¬ ìƒí’ˆ"],
    "policy_changes": ["ë³´í—˜ ë³€ê²½ì‚¬í•­"]
  }
}`;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadDefaultPrompt();
            loadPrompts();
        });

        // ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ë¡œë“œ
        function loadDefaultPrompt() {
            document.getElementById('prompt-content').value = DEFAULT_PROMPT;
            document.getElementById('prompt-name').value = 'ê¸°ë³¸ ë©”ëª¨ ë¶„ì„ í”„ë¡¬í”„íŠ¸';
            currentPromptId = null;
            updateButtonVisibility();
        }

        // ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
        function updateButtonVisibility() {
            const updateBtn = document.getElementById('update-btn');
            if (currentPromptId) {
                updateBtn.style.display = 'inline-block';
            } else {
                updateBtn.style.display = 'none';
            }
        }

        // ìƒˆ í”„ë¡¬í”„íŠ¸ ì €ì¥
        async function saveNewPrompt() {
            console.log('saveNewPrompt() í˜¸ì¶œë¨');
            const name = document.getElementById('prompt-name').value.trim();
            const content = document.getElementById('prompt-content').value.trim();

            if (!name || !content) {
                showResult('í”„ë¡¬í”„íŠ¸ ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
                const stored = localStorage.getItem('savedPrompts');
                savedPrompts = stored ? JSON.parse(stored) : [];
                
                // í•­ìƒ ìƒˆë¡œìš´ IDë¡œ í”„ë¡¬í”„íŠ¸ ìƒì„±
                const promptId = Date.now().toString();
                const prompt = {
                    id: promptId,
                    name: name,
                    content: content,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                savedPrompts.push(prompt);
                console.log('ìƒˆ í”„ë¡¬í”„íŠ¸ ìƒì„±:', prompt.name);

                localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                
                showResult(`ìƒˆ í”„ë¡¬í”„íŠ¸ "${name}"ì´(ê°€) ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                // ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨
                loadPrompts();
                
                // ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ë¥¼ í˜„ì¬ ì„ íƒìœ¼ë¡œ ì„¤ì •
                currentPromptId = promptId;
                updateButtonVisibility();
                
            } catch (error) {
                console.error('ìƒˆ í”„ë¡¬í”„íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                showResult('ìƒˆ í”„ë¡¬í”„íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ ìˆ˜ì •
        async function updatePrompt() {
            console.log('updatePrompt() í˜¸ì¶œë¨');
            const name = document.getElementById('prompt-name').value.trim();
            const content = document.getElementById('prompt-content').value.trim();

            if (!name || !content) {
                showResult('í”„ë¡¬í”„íŠ¸ ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (!currentPromptId) {
                showResult('ìˆ˜ì •í•  í”„ë¡¬í”„íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
                const stored = localStorage.getItem('savedPrompts');
                savedPrompts = stored ? JSON.parse(stored) : [];
                
                const existingIndex = savedPrompts.findIndex(p => p.id === currentPromptId);
                
                if (existingIndex >= 0) {
                    // ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ ìˆ˜ì • - created_at ìœ ì§€
                    const prompt = {
                        ...savedPrompts[existingIndex],
                        name: name,
                        content: content,
                        updated_at: new Date().toISOString()
                    };
                    savedPrompts[existingIndex] = prompt;
                    console.log('ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ ìˆ˜ì •:', prompt.name);

                    localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                    
                    showResult(`í”„ë¡¬í”„íŠ¸ "${name}"ì´(ê°€) ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    
                    // ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨
                    loadPrompts();
                } else {
                    showResult('ìˆ˜ì •í•  í”„ë¡¬í”„íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
                
            } catch (error) {
                console.error('í”„ë¡¬í”„íŠ¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜:', error);
                showResult('í”„ë¡¬í”„íŠ¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ëª©ë¡ ë¡œë“œ
        function loadPrompts() {
            console.log('loadPrompts() í˜¸ì¶œë¨');
            
            // DOMì´ ì™„ì „íˆ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            if (document.readyState !== 'complete') {
                console.log('DOMì´ ì•„ì§ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ì¬ì‹œë„...');
                setTimeout(loadPrompts, 100);
                return;
            }
            
            const listEl = document.getElementById('prompt-list');
            
            if (!listEl) {
                console.error('prompt-list ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ë¡œë”© ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ìƒì„±
            let loadingEl = document.getElementById('prompt-loading');
            if (!loadingEl) {
                console.log('prompt-loading ìš”ì†Œê°€ ì—†ì–´ì„œ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤');
                loadingEl = document.createElement('div');
                loadingEl.id = 'prompt-loading';
                loadingEl.className = 'loading';
                loadingEl.innerHTML = '<div class="spinner"></div>ë¡œë”© ì¤‘...';
                listEl.appendChild(loadingEl);
            }
            
            console.log('DOM ìš”ì†Œ í™•ì¸:', {
                loadingEl: !!loadingEl,
                listEl: !!listEl,
                loadingElId: loadingEl?.id,
                listElId: listEl?.id
            });
            
            // ë¡œë”© í‘œì‹œ
            loadingEl.classList.add('show');
            
            // ì§§ì€ ì§€ì—° í›„ ì‹¤í–‰ (UI ë°˜ì‘ì„±ì„ ìœ„í•´)
            setTimeout(() => {
                try {
                    const stored = localStorage.getItem('savedPrompts');
                    savedPrompts = stored ? JSON.parse(stored) : [];
                    console.log('ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ê°œìˆ˜:', savedPrompts.length);
                    
                    // ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ ì•„ì´í…œë“¤ë§Œ ì œê±° (ë¡œë”© ìš”ì†ŒëŠ” ë³´ì¡´)
                    const promptItems = listEl.querySelectorAll('.prompt-item');
                    promptItems.forEach(item => item.remove());
                    
                    // ê¸°ì¡´ ë©”ì‹œì§€ë“¤ ì œê±°
                    const messages = listEl.querySelectorAll('div:not(.loading):not(#prompt-loading)');
                    messages.forEach(msg => {
                        if (!msg.classList.contains('prompt-item') && msg.id !== 'prompt-loading') {
                            msg.remove();
                        }
                    });
                    
                    if (savedPrompts.length === 0) {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.style.cssText = 'padding: 20px; text-align: center; color: #6c757d;';
                        emptyMessage.textContent = 'ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';
                        listEl.appendChild(emptyMessage);
                    } else {
                        savedPrompts.forEach((prompt, index) => {
                            console.log(`í”„ë¡¬í”„íŠ¸ ${index + 1}: ${prompt.name}`);
                            const item = document.createElement('div');
                            item.className = 'prompt-item';
                            item.dataset.promptId = prompt.id;
                            
                            // í˜„ì¬ ì„ íƒëœ í”„ë¡¬í”„íŠ¸ì¸ì§€ í™•ì¸í•˜ì—¬ selected í´ë˜ìŠ¤ ì¶”ê°€
                            if (currentPromptId && currentPromptId === prompt.id) {
                                item.classList.add('selected');
                            }
                            
                            item.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">${prompt.name}</div>
                                        <div class="prompt-meta">
                                            ìƒì„±: ${new Date(prompt.created_at).toLocaleString()}
                                            ${prompt.updated_at !== prompt.created_at ? ' | ìˆ˜ì •: ' + new Date(prompt.updated_at).toLocaleString() : ''}
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px; margin: 0;" onclick="deletePrompt('${prompt.id}')" title="ì‚­ì œ" data-prompt-id="${prompt.id}">ğŸ—‘ï¸</button>
                                    </div>
                                </div>
                            `;
                            item.onclick = (e) => {
                                if (!e.target.closest('button')) {
                                    loadPromptContent(prompt);
                                }
                            };
                            listEl.appendChild(item);
                        });
                    }
                    
                } catch (error) {
                    console.error('í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                    
                    // ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì•ˆì „í•˜ê²Œ ì¶”ê°€
                    const promptItems = listEl.querySelectorAll('.prompt-item');
                    promptItems.forEach(item => item.remove());
                    
                    const errorMessage = document.createElement('div');
                    errorMessage.style.cssText = 'padding: 20px; text-align: center; color: #dc3545;';
                    errorMessage.textContent = 'í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    listEl.appendChild(errorMessage);
                } finally {
                    // ë¡œë”© í‘œì‹œ ì œê±°
                    loadingEl.classList.remove('show');
                    console.log('loadPrompts() ì™„ë£Œ');
                }
            }, 300);
        }

        // í”„ë¡¬í”„íŠ¸ ë‚´ìš© ë¡œë“œ
        function loadPromptContent(prompt) {
            document.getElementById('prompt-name').value = prompt.name;
            document.getElementById('prompt-content').value = prompt.content;
            currentPromptId = prompt.id;
            
            // ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            updateButtonVisibility();
            
            // ëª©ë¡ì—ì„œ ì„ íƒëœ í•­ëª© ì‹œê°ì  í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSelectedPrompt(prompt.id);
            
            showResult(`í”„ë¡¬í”„íŠ¸ "${prompt.name}"ì„(ë¥¼) ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ì„ íƒëœ í”„ë¡¬í”„íŠ¸ ì‹œê°ì  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedPrompt(selectedId) {
            const promptItems = document.querySelectorAll('.prompt-item');
            promptItems.forEach(item => {
                if (item.dataset.promptId === selectedId) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // í”„ë¡¬í”„íŠ¸ ì‚­ì œ
        function deletePrompt(promptId) {
            console.log('deletePrompt() í˜¸ì¶œë¨, ID:', promptId, 'íƒ€ì…:', typeof promptId);
            
            if (confirm('ì •ë§ë¡œ ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìµœì‹  ë°ì´í„° ë¡œë“œ
                    const stored = localStorage.getItem('savedPrompts');
                    savedPrompts = stored ? JSON.parse(stored) : [];
                    
                    console.log('ì‚­ì œ ëŒ€ìƒ í”„ë¡¬í”„íŠ¸ë“¤:', savedPrompts.map(p => ({ id: p.id, name: p.name, idType: typeof p.id })));
                    
                    const beforeCount = savedPrompts.length;
                    
                    // ID íƒ€ì… í™•ì¸í•˜ì—¬ ì ì ˆí•œ ë¹„êµ ìˆ˜í–‰
                    savedPrompts = savedPrompts.filter(p => {
                        const match = p.id == promptId || p.id === promptId || String(p.id) === String(promptId);
                        console.log(`í”„ë¡¬í”„íŠ¸ ${p.name}: ID ${p.id} (${typeof p.id}) vs ${promptId} (${typeof promptId}) -> ${match ? 'ì‚­ì œ' : 'ìœ ì§€'}`);
                        return !match;
                    });
                    
                    const afterCount = savedPrompts.length;
                    
                    console.log(`ì‚­ì œ ì „: ${beforeCount}ê°œ, ì‚­ì œ í›„: ${afterCount}ê°œ`);
                    
                    if (beforeCount === afterCount) {
                        console.warn('ì‚­ì œê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. IDê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        showResult('ì‚­ì œí•  í”„ë¡¬í”„íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                    
                    // í˜„ì¬ ì„ íƒëœ í”„ë¡¬í”„íŠ¸ê°€ ì‚­ì œëœ ê²½ìš° ì´ˆê¸°í™”
                    if (currentPromptId == promptId) {
                        clearPrompt();
                    }
                    
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadPrompts();
                    
                    showResult('í”„ë¡¬í”„íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                } catch (error) {
                    console.error('í”„ë¡¬í”„íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                    showResult('í”„ë¡¬í”„íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // í”„ë¡¬í”„íŠ¸ ì´ˆê¸°í™”
        function clearPrompt() {
            document.getElementById('prompt-name').value = '';
            document.getElementById('prompt-content').value = '';
            currentPromptId = null;
            
            // ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            updateButtonVisibility();
            
            // ì„ íƒëœ í•­ëª© í•´ì œ
            const promptItems = document.querySelectorAll('.prompt-item');
            promptItems.forEach(item => {
                item.classList.remove('selected');
            });
            
            showResult('í”„ë¡¬í”„íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì €ì¥ì†Œ ìƒíƒœ ë””ë²„ê¹…
        function debugStorage() {
            console.log('=== ì €ì¥ì†Œ ìƒíƒœ ë””ë²„ê¹… ===');
            
            try {
                const stored = localStorage.getItem('savedPrompts');
                const parsedPrompts = stored ? JSON.parse(stored) : [];
                
                console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì›ë³¸ ë°ì´í„°:', stored);
                console.log('íŒŒì‹±ëœ í”„ë¡¬í”„íŠ¸ ë°°ì—´:', parsedPrompts);
                console.log('í”„ë¡¬í”„íŠ¸ ê°œìˆ˜:', parsedPrompts.length);
                console.log('í˜„ì¬ ì„ íƒëœ í”„ë¡¬í”„íŠ¸ ID:', currentPromptId);
                console.log('ì „ì—­ savedPrompts ë³€ìˆ˜:', savedPrompts);
                
                let debugInfo = `ì €ì¥ì†Œ ë””ë²„ê·¸ ì •ë³´:\n`;
                debugInfo += `- í”„ë¡¬í”„íŠ¸ ê°œìˆ˜: ${parsedPrompts.length}\n`;
                debugInfo += `- í˜„ì¬ ì„ íƒëœ ID: ${currentPromptId || 'ì—†ìŒ'}\n`;
                debugInfo += `- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í¬ê¸°: ${stored ? stored.length : 0} ë¬¸ì\n\n`;
                
                if (parsedPrompts.length > 0) {
                    debugInfo += `ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ëª©ë¡:\n`;
                    parsedPrompts.forEach((prompt, index) => {
                        debugInfo += `${index + 1}. ${prompt.name} (ID: ${prompt.id})\n`;
                    });
                } else {
                    debugInfo += `ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.\n`;
                }
                
                showResult(debugInfo, 'success');
                
            } catch (error) {
                console.error('ì €ì¥ì†Œ ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜:', error);
                showResult(`ì €ì¥ì†Œ ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function testPrompt() {
            const prompt = document.getElementById('prompt-content').value.trim();
            const memo = document.getElementById('memo-input').value.trim();

            if (!prompt) {
                showResult('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (!memo) {
                showResult('í…ŒìŠ¤íŠ¸í•  ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const loadingEl = document.getElementById('test-loading');
            loadingEl.classList.add('show');

            try {
                const response = await fetch('/api/memo/refine', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        memo: memo,
                        custom_prompt: prompt
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    console.log(result)
                    // ì‚¬ìš©ì ì •ì˜ í”„ë¡¬í”„íŠ¸ì˜ ê²½ìš° raw_responseì™€ ì „ì²´ ê²°ê³¼ë¥¼ ëª¨ë‘ í‘œì‹œ
                    if (result.raw_response) {
                        const displayMessage = `=== AI ì›ë³¸ ì‘ë‹µ ===\n${result.raw_response}\n\n=== ì „ì²´ API ì‘ë‹µ ===\n${JSON.stringify(result, null, 2)}`;
                        showResult(displayMessage, 'success');
                    } else {
                        showResult(JSON.stringify(result, null, 2), 'success');
                    }
                } else {
                    showResult(`ì˜¤ë¥˜: ${result.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`, 'error');
                }
            } catch (error) {
                showResult(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                loadingEl.classList.remove('show');
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(message, type = 'success') {
            const container = document.getElementById('result-container');
            const resultBox = document.createElement('div');
            resultBox.className = `result-box ${type}`;

            resultBox.textContent = message;

            container.innerHTML = '';
            container.appendChild(resultBox);
            
            // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }

        // ê²°ê³¼ ì´ˆê¸°í™”
        function clearResults() {
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <p style="color: #6c757d; text-align: center; padding: 40px;">
                    í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </p>
            `;
        }
    </script>
</body>
</html>